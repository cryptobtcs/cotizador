<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cotizador Formal PDF</title>
  <script src="https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
      color: #111;
    }
    h1 {
      color: #b00000;
    }
    .container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input, select {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
      word-break: break-word;
    }
    th {
      background: #b00000;
      color: white;
    }
    .btn {
      background: #b00000;
      color: white;
      padding: 10px 20px;
      margin-top: 10px;
      border: none;
      cursor: pointer;
    }
    .btn:hover {
      background: #900000;
    }
    @media screen and (max-width: 600px) {
      .container {
        padding: 10px;
      }
      table, thead, tbody, th, td, tr {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Generador de Cotizaciones</h1>
  <input type="text" id="cliente" placeholder="Nombre del Cliente" />
  <input type="date" id="fecha" />

  <label>
    <input type="checkbox" id="incluyeIVA"> ¿Incluir IVA (16%)?
  </label>

  <h3>Agregar Producto/Servicio</h3>
  <input type="text" id="descripcion" placeholder="Descripción" />
  <input type="number" id="cantidad" placeholder="Cantidad" />
  <input type="text" id="unidad" placeholder="Unidad (ej. pieza, m2, kg)" />
  <input type="number" id="precio" placeholder="Precio Unitario" />
  <button class="btn" onclick="agregarProducto()">Agregar</button>

  <table id="tablaHTML">
    <thead>
      <tr>
        <th>Descripción</th>
        <th>Cantidad</th>
        <th>Unidad</th>
        <th>Precio</th>
        <th>Subtotal</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3 id="total"></h3>
  <button class="btn" onclick="generarPDF()">Descargar PDF</button>
</div>

<!-- PDF ZONA -->
<div id="pdf-area" style="display:none; padding: 20px; font-family: Arial;">
  <h2 style="color:#b00000;">Cotización</h2>
  <table>
    <tr>
      <td style="font-weight:bold;">Cliente:</td>
      <td id="pdf-cliente"></td>
      <td style="font-weight:bold;">Fecha:</td>
      <td id="pdf-fecha"></td>
    </tr>
  </table>

  <table style="margin-top: 20px;">
    <thead>
      <tr style="background-color: #b00000; color: white;">
        <th>Descripción</th>
        <th>Cantidad</th>
        <th>Unidad</th>
        <th>Precio</th>
        <th>Subtotal</th>
      </tr>
    </thead>
    <tbody id="pdf-body"></tbody>
  </table>

  <h3 id="pdf-total" style="margin-top: 20px;"></h3>
</div>

<script>
  let productos = [];

  function agregarProducto() {
    const descripcion = document.getElementById("descripcion").value;
    const cantidad = parseFloat(document.getElementById("cantidad").value);
    const unidad = document.getElementById("unidad").value;
    const precio = parseFloat(document.getElementById("precio").value);

    if (!descripcion || !cantidad || !unidad || !precio) {
      alert("Faltan datos");
      return;
    }

    const subtotal = cantidad * precio;
    productos.push({ descripcion, cantidad, unidad, precio, subtotal });

    const row = `<tr>
      <td>${descripcion}</td>
      <td>${cantidad}</td>
      <td>${unidad}</td>
      <td>$${precio.toFixed(2)}</td>
      <td>$${subtotal.toFixed(2)}</td>
    </tr>`;

    document.querySelector("#tablaHTML tbody").innerHTML += row;
    actualizarTotal();

    document.getElementById("descripcion").value = "";
    document.getElementById("cantidad").value = "";
    document.getElementById("unidad").value = "";
    document.getElementById("precio").value = "";
  }

  function actualizarTotal() {
    const total = productos.reduce((sum, p) => sum + p.subtotal, 0);
    document.getElementById("total").innerText = `Total: $${total.toFixed(2)}`;
  }

  function generarPDF() {
    if (productos.length === 0) {
      alert("Agrega al menos un producto o servicio");
      return;
    }

    const cliente = document.getElementById("cliente").value;
    const fecha = document.getElementById("fecha").value;
    const incluirIVA = document.getElementById("incluyeIVA").checked;

    if (!cliente || !fecha) {
      alert("Faltan datos del cliente o fecha");
      return;
    }

    document.getElementById("pdf-cliente").innerText = cliente;
    document.getElementById("pdf-fecha").innerText = fecha;

    const cuerpoTabla = document.getElementById("pdf-body");
    cuerpoTabla.innerHTML = "";
    let total = 0;

    productos.forEach(p => {
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td>${p.descripcion}</td>
        <td>${p.cantidad}</td>
        <td>${p.unidad}</td>
        <td>$${p.precio.toFixed(2)}</td>
        <td>$${p.subtotal.toFixed(2)}</td>
      `;
      cuerpoTabla.appendChild(fila);
      total += p.subtotal;
    });

    if (incluirIVA) {
      const iva = total * 0.16;
      total += iva;
    }

    document.getElementById("pdf-total").innerText = `TOTAL: $${total.toFixed(2)}`;

    const pdfArea = document.getElementById("pdf-area");
    pdfArea.style.display = "block";

    const opt = {
      margin: 0.5,
      filename: `cotizacion_${cliente}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().from(pdfArea).set(opt).save().then(() => {
      pdfArea.style.display = "none";
    });
  }
</script>
</body>
</html>
